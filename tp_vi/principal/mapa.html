<html lang="en">
    <head>
       <meta charset="utf-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Remuneraci&oacute;n Anual por Sector</title>
       <!-- <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
       <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
       <script type="text/javascript" src="http://d3js.org/queue.v1.min.js"></script> -->
       <script src="js/jquery.js"></script>
       <script src="js/bootstrap.js"></script>
       <script type="text/javascript" src="js/d3.v3.min.js"></script>
       <script type="text/javascript" src="js/topojson.v1.min.js"></script>
       <script type="text/javascript" src="js/queue.v1.min.js"></script> 
       <script type="text/javascript" src="js/jquery.tipsy.js"></script>

       <link href="css/bootstrap-responsive.css" rel="stylesheet">
       <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
       <link rel="stylesheet" href="css/mapa.css">
       </head>
       <body>
           <div class="navbar  navbar-static-top">
           <div class="navbar-inner">
               <a class="brand" href="index.html">Visualizaciones</a>
		    <ul class="nav">
			<li><a href="#">Integrantes</a></li>
			<li class="divider-vertical"></li>
			<li class="divider-vertical"></li>
			<li><a href="empleo_sector.html">Empleo Anual Por Sector</a></li>
			<li><a href="http://78.47.89.42:8100">Empleo Trimestral por provincia</a></li>
			<li><a href="mapa.html">Remuración Anual por Sector</a></li>
			<li><a href="maps_desocupacion.html">Coordenadas Paralelas</a></li>
			<li class="divider-vertical"></li>
			<li><a href="#">Referencias</a></li>
		    </ul>
           </div>
           </div>
           <script type="text/javascript">
           $(document).ready(function(){

           var width = 800,
               height = 600;
           var color = new Array();
               color['Empleo'] = "red";
               color['Desocupacion'] = "steelblue";

           var radius = d3.scale.sqrt()
                                .domain([0, 50])
                                .range([0, 16]);

           var svg = d3.select("#mapa2010").append("svg")
                                      .attr("width", width)
                                      .attr("height", height);

           var projection = d3.geo.mercator()
                                  .center([-70, -39 ])
                                  .scale(700)
                                  .translate([ 100 , 250 ])
				  .precision(.1); 

           var path = d3.geo.path()
                            .projection(projection);

           queue()
           .defer(d3.json, "data/arg_adm1.topojson")
           .defer(d3.json, "data/eph20101centroide.geojson")
           .defer(d3.json, "data/centroide_provincia2010.geojson")
           .await(ready);

           function ready(error, us, centroid, cent2010) {

           var tooltip = d3.select("#mapa2010").append("div")   
                       .attr("class", "tooltip")               
                       .style("opacity", 0.5);
           
           //drawing each province
           //taking from http://bost.ocks.org/mike/map/
           //and here http://techslides.com/d3-world-maps-tooltips-zooming-and-queue/
           svg.selectAll(".province")
              .data(topojson.feature(us, us.objects.ARG_adm1).features)
              .enter().append("path")
              .attr("class", function(d,i){return "province_"+d.properties.ID_1})
              .attr("d", path)
              .on("mouseover", function(d,i){
                   d3.select(this).style("fill", "green");
                   var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
                   tooltip.classed("hidden", false)
                         .attr("style", "left:"+(mouse[0]+25)+"px;top:"+mouse[1]+"px")
                         .html(dohtmltooltips(d));
                   })
              .on("mouseout",  function(d,i) {
                  d3.select(this).style("fill", "gray");
                  tooltip.classed("hidden", true);
              });

           //drawing unemployment
           svg.selectAll(".symbol")
              .data(centroid.features)
              .enter().append("path")
              .attr("class", "symbol")
              .attr("d", path.pointRadius(
		function(d) { 
                 return radius(d.properties.desocupacion); 
                }));

           //drawing employment
           svg.selectAll(".symbol2")
              .data(centroid.features)
              .enter().append("path")
              .attr("class", "symbol2")
              .attr("d", path.pointRadius(function(d) { return radius(d.properties.empleo); }))
              .on("mouseover", function(d,i){
		var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
                tooltip.classed("hidden", false)
                         .attr("style", "left:"+(mouse[0]+25)+"px;top:"+mouse[1]+"px")
                         .html(dohtmltooltips(d));

              })
              .on("mouseout",  function(d,i) {
                  tooltip.classed("hidden", true);
              });

           // drawing legend
           var legend = svg.selectAll(".legend")  
                           .data(Object.keys(color))
                           .enter().append("g")
                           .attr("class", "legend")
                           .attr("transform", function(d, i){ return "translate(0,"+ i * 20 + ")"; });

           legend.append("rect") 
                 .attr("x", width - 300)
                 .attr("width", 18)
                 .attr("height", 18)
                 .attr("y", 30 )
                 .style("fill", function (d, i) { return color[d]});
           legend.append("text")
                 .attr("x", width - 400)
                 .attr("y", 40)
                 .attr("dy", ".35em")
                 .text(function(d){return d;});

           //drawin tooltips
           dohtmltooltips = function(d) {
               var html;
               if (d.properties.ISO==null & d.properties.NAME_1!=null ) {
                   html = 'Provincia: ' + d.properties.NAME_1.toLowerCase();
               }
               else {
                   
                   if (d.properties.NAME_2=="Bahia Blanca") {
                       html = 'Provincia: ' + d.properties.NAME_2.toLowerCase();
                   }
                   else {
                       html = 'Provincia: ' + (d.properties.JURISDICCI).toLowerCase();
                   }
               }
               html = html + '<br/>'+' Actividad:'+ d.properties.actividad;
               html = html + '<br/>'+' Desocupación:'+ d.properties.desocupacion;
               html = html + '<br/>'+' Empleo:'+ d.properties.empleo;
               html = html + '<br/>'+' SubOcupación Demandante:'+ d.properties.subocupacion_demandante;
               return html;
           }

           } //end function ready d3
           }); //end document ready jquery
</script>
           <div class="container-fluid">
               <div class="row-fluid">
               <div class="span3">
               Esto es un Texto
               </div>
               <div class="span9" id="mapa2010">
               </div>
           </div>
</body>
</html>
